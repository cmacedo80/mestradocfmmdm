
R version 3.3.1 (2016-06-21) -- "Bug in Your Hair"
Copyright (C) 2016 The R Foundation for Statistical Computing
Platform: i386-w64-mingw32/i386 (32-bit)

R é um software livre e vem sem GARANTIA ALGUMA.
Você pode redistribuí-lo sob certas circunstâncias.
Digite 'license()' ou 'licence()' para detalhes de distribuição.

R é um projeto colaborativo com muitos contribuidores.
Digite 'contributors()' para obter mais informações e
'citation()' para saber como citar o R ou pacotes do R em publicações.

Digite 'demo()' para demonstrações, 'help()' para o sistema on-line de ajuda,
ou 'help.start()' para abrir o sistema de ajuda em HTML no seu navegador.
Digite 'q()' para sair do R.

> #########################################################
> # script de treinamento dos modelos 
> # Autor: Cristiano Francis Matos de Macedo
> #########################################################
> 
> # install.packages('randomForest')
> 
> library(neuralnet)
> library(e1071) 
> library(dplyr)

Attaching package: 'dplyr'

The following object is masked from 'package:neuralnet':

    compute

The following objects are masked from 'package:stats':

    filter, lag

The following objects are masked from 'package:base':

    intersect, setdiff, setequal, union

> library(party)
Carregando pacotes exigidos: grid
Carregando pacotes exigidos: mvtnorm
Carregando pacotes exigidos: modeltools
Carregando pacotes exigidos: stats4
Carregando pacotes exigidos: strucchange
Carregando pacotes exigidos: zoo

Attaching package: 'zoo'

The following objects are masked from 'package:base':

    as.Date, as.Date.numeric

Carregando pacotes exigidos: sandwich
> library(tm)
Carregando pacotes exigidos: NLP
> library(caret)
Carregando pacotes exigidos: lattice
Carregando pacotes exigidos: ggplot2

Attaching package: 'ggplot2'

The following object is masked from 'package:NLP':

    annotate

> library(rpart)
> library(rpart.plot)
> library(e1071)
> library(nnet)
> library(wordcloud)
Carregando pacotes exigidos: RColorBrewer
> library(Rserve)
> library(randomForest)
randomForest 4.6-12
Type rfNews() to see new features/changes/bug fixes.

Attaching package: 'randomForest'

The following object is masked from 'package:ggplot2':

    margin

The following object is masked from 'package:dplyr':

    combine

> 
> #########################################################
> # Configuração
> #########################################################
> #cores
> pal2 <- brewer.pal(8,"Dark2")
> 
> # comando para permitir a comunicaÃ§Ã£o com o aplicativo java
> # Rserve(args = '--no-save')
> 
> 
> #########################################################
> # Carga dos dados
> #########################################################
> 
> Sys.setlocale("LC_ALL", locale="pt_PT.UTF-8")
[1] ""
Warning message:
In Sys.setlocale("LC_ALL", locale = "pt_PT.UTF-8") :
  SO informa que a requisição para definir o locale como 'pt_PT.UTF-8' não pode ser honrada
> ag <- read.csv(file="ag.csv", header=TRUE, sep=";",encoding = 'UTF-8',nrows = 10000,stringsAsFactors = F)
> pj <- read.csv(file="pj.csv", header=TRUE, sep=";",encoding = 'UTF-8',nrows = 10000,stringsAsFactors = F)
> 
> set.seed(1234)
> indices_ag <- sample( 1:4000, 4000)
> set.seed(1234)
> indices_pj <- sample( 4001:8000, 4000)
> 
> ag.tr <- indices_ag[1:2400]     # %60
> ag.va <- indices_ag[2401:3200]  # %20
> ag.te <- indices_ag[3201:4000]  # %20
> 
> pj.tr <- indices_pj[1:2400]     # %60
> pj.va <- indices_pj[2401:3200]  # %20
> pj.te <- indices_pj[3201:4000]  # %20
> 
> 
> #########################################################
> # Geração da WordCloud
> #########################################################
> 
> #  ag_corpus = Corpus(VectorSource(ag$titulo))
> #  ag_corpus = tm_map(ag_corpus, content_transformer(tolower))
> #  ag_corpus = tm_map(ag_corpus, removeNumbers)
> #  ag_corpus = tm_map(ag_corpus, removePunctuation)
> #  ag_corpus = tm_map(ag_corpus, removeWords, c(stopwords("portuguese")))
> #  ag_corpus =  tm_map(ag_corpus, stripWhitespace)
> #  ag_corpus =  tm_map(ag_corpus, PlainTextDocument)
> #  ag_corpus =  tm_map(ag_corpus, stemDocument)
> #  wordcloud(ag_corpus,max.words = 100, min.freq = 2,random.order = FALSE,colors=pal2)
> # 
> #  pj_corpus = Corpus(VectorSource(pj$titulo))
> #  pj_corpus = tm_map(pj_corpus, content_transformer(tolower))
> #  pj_corpus = tm_map(pj_corpus, removeNumbers)
> #  pj_corpus = tm_map(pj_corpus, removePunctuation)
> #  pj_corpus = tm_map(pj_corpus, removeWords, c(stopwords("portuguese")))
> #  pj_corpus =  tm_map(pj_corpus, stripWhitespace)
> #  pj_corpus =  tm_map(pj_corpus, PlainTextDocument)
> #  pj_corpus =  tm_map(pj_corpus, stemDocument)
> # wordcloud(pj_corpus,max.words = 100, min.freq = 2,random.order = FALSE,colors=pal2)
> 
> #########################################################
> # Preparação das bases de treinamento, validacao e teste
> #########################################################
> atividades  = rbind(ag,pj)
> 
> atividades_corpus = Corpus(VectorSource(atividades$titulo))
> atividades_corpus = tm_map(atividades_corpus, content_transformer(tolower))
> atividades_corpus = tm_map(atividades_corpus, removeNumbers)
> atividades_corpus = tm_map(atividades_corpus, removePunctuation)
> atividades_corpus = tm_map(atividades_corpus, removeWords, c(stopwords("portuguese")))
> atividades_corpus = tm_map(atividades_corpus, stripWhitespace)
> atividades_corpus = tm_map(atividades_corpus, stemDocument)
> atividades_corpus = tm_map(atividades_corpus, PlainTextDocument)
> #atividades_dtm <- DocumentTermMatrix(atividades_corpus)
> #atividades_dtm = removeSparseTerms(atividades_dtm, 0.99)
> #findFreqTerms(atividades_dtm, 2)
> 
> #atividades_dtm_tfidf <- DocumentTermMatrix(atividades_corpus, control = list(weighting = weightTfIdf))
> atividades_dtm_tfidf <- DocumentTermMatrix(atividades_corpus)
> atividades_dtm_tfidf = removeSparseTerms(atividades_dtm_tfidf, 0.99)
> #findFreqTerms(atividades_dtm_tfidf, 1)
> 
> atividades$titulo = NULL
> atividades = cbind(atividades, as.matrix(atividades_dtm_tfidf))
> atividades$descricao = as.factor(atividades$descricao)
> 
> #set.seed(1234)
> #indices = sample(3, nrow(atividades) , repl = TRUE,prob = c(0.6,0.2,0.2))
> 
> atividades.train<-rbind(atividades[ag.tr,],atividades[pj.tr,])
> atividades.validation<-rbind(atividades[ag.va,],atividades[pj.va,])
> atividades.test<-rbind(atividades[ag.te,],atividades[pj.te,])
> 
> #atividades.train      <- atividades[indices == 1,]
> #atividades.validation <- atividades[indices == 2,]
> #atividades.test       <- atividades[indices == 3,]
> 
> #ag_indices <- which(atividades$descricao =="acaogerencial")
> #pj_indices <- which(atividades$descricao =="projeto")
> 
> #atividades[ag_indices,]
> #
> # Treinamento e predição com a arvore de decisao
> atividades.tree = rpart(descricao~.,  method = "class", data = atividades.train);  
> pred.tree = predict(atividades.tree, atividades.validation,  type="class")
> table(atividades.validation$descricao,pred.tree,dnn=c("Real","Previsto"))
               Previsto
Real            acaogerencial projeto
  acaogerencial           479     321
  projeto                  85     715
> caret::confusionMatrix(table(atividades.validation$descricao,pred.tree,dnn=c("Real","Previsto")))
Confusion Matrix and Statistics

               Previsto
Real            acaogerencial projeto
  acaogerencial           479     321
  projeto                  85     715
                                          
               Accuracy : 0.7462          
                 95% CI : (0.7242, 0.7674)
    No Information Rate : 0.6475          
    P-Value [Acc > NIR] : < 2.2e-16       
                                          
                  Kappa : 0.4925          
 Mcnemar's Test P-Value : < 2.2e-16       
                                          
            Sensitivity : 0.8493          
            Specificity : 0.6902          
         Pos Pred Value : 0.5988          
         Neg Pred Value : 0.8938          
             Prevalence : 0.3525          
         Detection Rate : 0.2994          
   Detection Prevalence : 0.5000          
      Balanced Accuracy : 0.7697          
                                          
       'Positive' Class : acaogerencial   
                                          
> 
> # Treinamento e predição com naives bayes
> atividades.naiveBayes <- naiveBayes(descricao ~ ., data = atividades.train)
> pred.naiveBayes <- predict(atividades.naiveBayes,atividades.validation)
> #table(atividades.validation$descricao,pred=pred.naiveBayes,dnn=c("Real","Previsto"))
> caret::confusionMatrix(table(atividades.validation$descricao,pred=pred.naiveBayes,dnn=c("Real","Previsto")))
Confusion Matrix and Statistics

               Previsto
Real            acaogerencial projeto
  acaogerencial           545     255
  projeto                 127     673
                                         
               Accuracy : 0.7612         
                 95% CI : (0.7396, 0.782)
    No Information Rate : 0.58           
    P-Value [Acc > NIR] : < 2.2e-16      
                                         
                  Kappa : 0.5225         
 Mcnemar's Test P-Value : 8.146e-11      
                                         
            Sensitivity : 0.8110         
            Specificity : 0.7252         
         Pos Pred Value : 0.6813         
         Neg Pred Value : 0.8412         
             Prevalence : 0.4200         
         Detection Rate : 0.3406         
   Detection Prevalence : 0.5000         
      Balanced Accuracy : 0.7681         
                                         
       'Positive' Class : acaogerencial  
                                         
> #table(atividades.validation$descricao,pred.naiveBayes,dnn=c("Obs","Pred"))
> 
> # Treinamento e predição com random folrest
> atividades.randomForest <- randomForest(descricao ~ .,  data=atividades.train, importance=TRUE,   ntree=2000)
> pred.randomForest <- predict(atividades.randomForest, atividades.validation)
> #table(atividades.validation$descricao,pred=pred.randomForest,dnn=c("Real","Previsto"))
> caret::confusionMatrix(table(atividades.validation$descricao,pred=pred.randomForest,dnn=c("Real","Previsto")))
Confusion Matrix and Statistics

               Previsto
Real            acaogerencial projeto
  acaogerencial           618     182
  projeto                 116     684
                                          
               Accuracy : 0.8138          
                 95% CI : (0.7938, 0.8325)
    No Information Rate : 0.5412          
    P-Value [Acc > NIR] : < 2.2e-16       
                                          
                  Kappa : 0.6275          
 Mcnemar's Test P-Value : 0.0001663       
                                          
            Sensitivity : 0.8420          
            Specificity : 0.7898          
         Pos Pred Value : 0.7725          
         Neg Pred Value : 0.8550          
             Prevalence : 0.4587          
         Detection Rate : 0.3862          
   Detection Prevalence : 0.5000          
      Balanced Accuracy : 0.8159          
                                          
       'Positive' Class : acaogerencial   
                                          
> 
> # Treinamento e predição com SVM
> atividades.svm = svm(descricao~., data = atividades.train);
> pred.svm = predict(atividades.svm, atividades.validation)
> #table(atividades.validation$descricao,pred.svm,dnn=c("Real","Previsto"))
> caret::confusionMatrix(table(atividades.validation$descricao,pred.svm,dnn=c("Real","Previsto")))
Confusion Matrix and Statistics

               Previsto
Real            acaogerencial projeto
  acaogerencial           615     185
  projeto                 110     690
                                          
               Accuracy : 0.8156          
                 95% CI : (0.7957, 0.8343)
    No Information Rate : 0.5469          
    P-Value [Acc > NIR] : < 2.2e-16       
                                          
                  Kappa : 0.6313          
 Mcnemar's Test P-Value : 1.644e-05       
                                          
            Sensitivity : 0.8483          
            Specificity : 0.7886          
         Pos Pred Value : 0.7688          
         Neg Pred Value : 0.8625          
             Prevalence : 0.4531          
         Detection Rate : 0.3844          
   Detection Prevalence : 0.5000          
      Balanced Accuracy : 0.8184          
                                          
       'Positive' Class : acaogerencial   
                                          
> 
> # Predição final com a base de teste com o random forest
> pred.randomForest <- predict(atividades.randomForest, atividades.test)
> caret::confusionMatrix(table(atividades.validation$descricao,pred=pred.randomForest,dnn=c("Real","Previsto")))
Confusion Matrix and Statistics

               Previsto
Real            acaogerencial projeto
  acaogerencial           643     157
  projeto                 112     688
                                          
               Accuracy : 0.8319          
                 95% CI : (0.8126, 0.8499)
    No Information Rate : 0.5281          
    P-Value [Acc > NIR] : < 2.2e-16       
                                          
                  Kappa : 0.6638          
 Mcnemar's Test P-Value : 0.007302        
                                          
            Sensitivity : 0.8517          
            Specificity : 0.8142          
         Pos Pred Value : 0.8038          
         Neg Pred Value : 0.8600          
             Prevalence : 0.4719          
         Detection Rate : 0.4019          
   Detection Prevalence : 0.5000          
      Balanced Accuracy : 0.8329          
                                          
       'Positive' Class : acaogerencial   
                                          
> 
> #save(preditor,atividades_dtm_tfidf,file="modelo.RData")
> save.image("modelo.RDAta")
> preditor <- atividades.svm;
> save(preditor, atividades_dtm_tfidf, file="var.RData")
> #save.image(file="cfmm.RData")
> 
> 
> 
> proc.time()
  usuário   sistema decorrido 
   392.04      0.81    394.16 
